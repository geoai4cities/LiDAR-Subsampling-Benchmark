################################################################################
# DEPOCO Configuration: final_skitti_82.5
# Target Loss: ~30% (Actual: 29.0% verified)
# subsampling_dist: 0.85
################################################################################
train:
  experiment_id: "final_skitti_82.5"
  max_epochs: 250
  use_adam: True
  batch_size: 10
  max_nr_pts: 500000
  workers: 0
  optimizer:
    start_lr: 0.000001
    max_lr: 0.0001
    end_lr: 0.00001
    pct_incr_cycle: 0.1
    anneal_strategy: "cos"
    momentum: 0.9
  nr_submaps: 0
  load_pretrained: False
  sampling_method: "random"
  map_prob_rate: -1
  loss_weights:
    transf2map: 1.0
    map2transf: 1.0
    upsampling_reg: 0.2
  validation:
    report_rate: 1
    save_result_rate: 500

################################################################################
# Voxel Grid parameter (for data generation)
################################################################################
grid:
  pose_distance: 15
  size:
    - 40.0
    - 40.0
    - 15.0
  dz: 4.0
  voxel_size: 0.1
  max_range: 20.0
  min_range: 2.0
  features: ['intensity','label','eigenvalues','normals']
  feature_dim: [1,1,3,3]
  normal_eigenvalue_radius: 0.5

evaluation:
  float16: True
  iou_grid:
    resolution: [0.2,0.2,0.1]
  f_score_dist: 0.1
  out_dir: 'experiments/depoco/'

################################################################################
# Network parameters
################################################################################
network:
  encoder_blocks:
    - type: "GridSampleConv"
      number_blocks: 3
      parameters:
        in_fdim: [1, 16, 32]
        out_fdim: [16, 32, 32]
        num_kernel_points: 27
        max_nr_neighbors: [70, 50, 25]
        relu: True
        batchnorm: True
        deformable: False
        subsampling_dist: 0.85  # KEY: Controls compression (~30% loss)
        map_size: 40
        subsampling_factor: [0.1, 0.5, 1.0]
        kernel_radius: 1.0
        min_kernel_radius: 1.5
        use_dif_sampling: False
    - type: "LinearLayer"
      number_blocks: 1
      parameters:
        in_fdim: 32
        out_fdim: 3
        relu: False
        batchnorm: False
  decoder_blocks:
    - type: "AdaptiveDeconv"
      number_blocks: 4
      parameters:
        number_blocks: 4
        block_id: [0, 1, 2, 3]
        subsampling_dist: 0.05
        in_fdim: [3, 32, 32, 32]
        out_fdim: 32
        kernel_radius: 0.05
        relu: True
        use_batch_norm: False
        inter_fdim: 128
        estimate_radius: False
        subsampling_fct_p1: 0.006
        subsampling_fct_p2: 1.764
    - type: "LinearLayer"
      number_blocks: 1
      parameters:
        in_fdim: 32
        out_fdim: 3
        relu: False
        batchnorm: False
  out_dir: "network_files/"
  intermediate_dir: "intermediate_net_files/"

################################################################################
# Dataset paths (UPDATE THESE FOR YOUR ENVIRONMENT)
################################################################################
dataset:
  data_folders:
    grid_output: "${DEPOCO_DATA_DIR}/submaps/"  # Path to preprocessed submaps
    prefix: "/data/"
    train:
      - "train"
    valid:
      - "validation"
    test:
      - "validation"
