# DALES Dataset Structure Update

**Date:** November 24, 2025
**Status:** ✅ RESOLVED - Using Actual Data Structure

---

## Issue

Initial documentation referenced DALES tiles (5030001, 5030002, 5030020, 5030040) that don't exist in the actual data directory.

---

## Resolution

**User Decision:** Use existing train (29) / test (11) directory structure (Option 1)

---

## Actual Data Structure

### Source Location
```
data/DALES/original/dales_ply/
├── train/  (29 tiles)
│   ├── 5080_54435.ply
│   ├── 5085_54320.ply
│   ├── 5095_54440.ply
│   └── ... (26 more)
│
└── test/   (11 tiles)
    ├── 5080_54400.ply
    ├── 5080_54470.ply
    ├── 5100_54440.ply
    └── ... (8 more)
```

### Total: 40 tiles

---

## Updated Splits

### Train: 23 tiles (~80% of train directory)

```python
train = [
    "5085_54320", "5095_54440", "5095_54455", "5105_54405", "5105_54460",
    "5110_54320", "5110_54460", "5110_54475", "5110_54495", "5115_54480",
    "5135_54495", "5140_54445", "5145_54340", "5145_54405", "5145_54460",
    "5145_54480", "5150_54340", "5160_54330", "5165_54390", "5180_54435",
    "5180_54485", "5185_54390", "5185_54485"
]
```

### Validation: 6 tiles (~20% of train directory)

**Selected for spatial distribution:**

```python
val = [
    "5080_54435",  # Northwest
    "5100_54495",  # North-central
    "5130_54355",  # Central
    "5145_54470",  # South-central
    "5165_54395",  # South
    "5190_54400"   # Southeast
]
```

**Rationale:**
- 6 tiles provide ~20% validation split (6/29 ≈ 20.7%)
- Tiles selected from different spatial regions for good coverage
- Tile names format: NORTH_EAST (e.g., 5080_54435 = 5080m north, 54435m east)

### Test: 11 tiles (test directory)

```python
test = [
    "5080_54400", "5080_54470", "5100_54440", "5100_54490", "5120_54445",
    "5135_54430", "5135_54435", "5140_54390", "5150_54325", "5155_54335",
    "5175_54395"
]
```

---

## Summary Statistics

| Split | Tiles | Percentage |
|-------|-------|------------|
| Train | 23 | 57.5% of total |
| Val | 6 | 15% of total |
| Test | 11 | 27.5% of total |
| **Total** | **40** | **100%** |

**Train+Val:** 29 tiles (72.5% of total)

---

## Comparison with Original Plan

### Original (Documented)
- Train: 2 tiles (5030001, 5030002)
- Val: 1 tile (5030020)
- Test: 1 tile (5030040)
- **Total: 4 tiles**

### Updated (Actual Data)
- Train: 23 tiles
- Val: 6 tiles
- Test: 11 tiles
- **Total: 40 tiles**

### Benefits of Actual Data
1. **10x more data** (40 vs 4 tiles)
2. **Better generalization** - more spatial coverage
3. **More reliable validation** - 6 tiles vs 1 tile
4. **Robust testing** - 11 tiles vs 1 tile
5. **Consistent with original DALES dataset** - uses provided train/test split

---

## Updated Dataset Loader

**File:** `PTv3/PointTransformerV3/Pointcept/pointcept/datasets/dales.py`

**Key Changes:**
1. Updated `get_data_list()` method with actual tile names
2. Split 29 train directory tiles into train (23) + val (6)
3. Use all 11 test directory tiles for testing
4. Updated docstring to reflect actual structure

**Status:** ✅ Updated and ready

---

## Impact on Configurations

**No changes required** to existing 18 DALES configs:
- Configs reference `data_root` path which will work with any tile structure
- Dataset loader handles tile-to-file mapping internally
- All configs remain valid

**Config locations:**
- `PTv3/DALES/configs/dales/generated/*.py` (18 configs)

---

## Data Preparation Checklist

### For Original Data (PLY format)

- [ ] Verify PLY files exist: `data/DALES/original/dales_ply/{train,test}/`
- [ ] Convert PLY to TXT format (x, y, z, intensity, return_num, num_returns, class)
- [ ] Place TXT files in appropriate subsampling directories

### For Subsampled Data

Will be generated by subsampling scripts:
```
data/DALES/subsampled/
├── RS_loss0/        # Random Sampling, 0% loss
│   ├── 5085_54320.txt
│   ├── 5095_54440.txt
│   └── ... (40 tiles)
├── RS_loss50/       # Random Sampling, 50% loss
│   └── ... (40 tiles)
├── IDIS_loss0/      # IDIS, 0% loss
│   └── ... (40 tiles)
└── ... (6 loss levels × 4 methods = 24 subdirectories)
```

---

## Spatial Distribution Map

```
Tile Coverage (approximate):
North
  ↑
  |  5080_54435 (Val) ---- 5100_54495 (Val)
  |         |                    |
  |    [train tiles]        [train tiles]
  |         |                    |
  |  5130_54355 (Val) ---- 5145_54470 (Val)
  |         |                    |
  |    [train tiles]        [train tiles]
  |         |                    |
  |  5165_54395 (Val) ---- 5190_54400 (Val)
  ↓
South

West ←―――――――――――――――――――――→ East
```

Validation tiles distributed across spatial extent for representative sampling.

---

## Next Steps

1. **Convert PLY to TXT** (if needed)
   - Script: `scripts/convert_ply_to_txt.py`
   - Input: `data/DALES/original/dales_ply/{train,test}/*.ply`
   - Output: `data/DALES/original/{train,test}/*.txt`

2. **Generate Subsampled Datasets**
   - Script: `scripts/generate_subsampled_dales.py`
   - Methods: RS, IDIS, FPS, DBSCAN
   - Loss levels: 0%, 10%, 30%, 50%, 70%, 90%
   - Total: 4 methods × 6 loss × 40 tiles = 960 files

3. **Verify Dataset Loading**
   ```bash
   source PTv3/activate.sh
   python -c "from pointcept.datasets import DALESDataset; \
              ds = DALESDataset(split='train', data_root='data/DALES/subsampled/RS_loss0'); \
              print(f'Train tiles: {len(ds)}'); \
              ds = DALESDataset(split='val', data_root='data/DALES/subsampled/RS_loss0'); \
              print(f'Val tiles: {len(ds)}'); \
              ds = DALESDataset(split='test', data_root='data/DALES/subsampled/RS_loss0'); \
              print(f'Test tiles: {len(ds)}')"
   ```

---

## References

**Original DALES Dataset:**
- Website: https://udayton.edu/engineering/research/centers/vision_lab/research/was_data_analysis_and_processing/dale.php
- Paper: "DALES: A Large-scale Aerial LiDAR Data Set for Semantic Segmentation"

**Dataset Loader:**
- File: `PTv3/PointTransformerV3/Pointcept/pointcept/datasets/dales.py`
- Registered in: `pointcept/datasets/__init__.py`

**Related Documentation:**
- `PTv3/DALES/docs/DALES_LOADER_VERIFICATION.md` - Loader verification
- `PTv3/DALES/docs/CONFIG_UPDATE_OUTDOOR_PATTERN.md` - Config rationale
- `PTv3/DALES/docs/PTv3m1_VERIFICATION.md` - PT-v3m1 verification

---

**Last Updated:** November 24, 2025
**Status:** ✅ RESOLVED - Dataset loader updated with actual 40-tile structure
**Action:** Ready to proceed with data generation
